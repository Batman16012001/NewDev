/*! For license information please see index.js.LICENSE.txt */
var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=(e=>e.CapacitorPlatforms=(e=>{const t=new Map;t.set("web",{name:"web"});const s=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t};return s.addPlatform=(e,t)=>{s.platforms.set(e,t)},s.setPlatform=e=>{s.platforms.has(e)&&(s.currentPlatform=s.platforms.get(e))},s})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e.g?e.g:{});var s;t.addPlatform,t.setPlatform,function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(s||(s={}));class a extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const n=(e=>e.Capacitor=(e=>{var t,n,i,r,o;const c=e.CapacitorCustomPlatform||null,l=e.Capacitor||{},d=l.Plugins=l.Plugins||{},u=e.CapacitorPlatforms,h=(null===(t=null==u?void 0:u.currentPlatform)||void 0===t?void 0:t.getPlatform)||(()=>null!==c?c.name:(e=>{var t,s;return(null==e?void 0:e.androidBridge)?"android":(null===(s=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===s?void 0:s.bridge)?"ios":"web"})(e)),p=(null===(n=null==u?void 0:u.currentPlatform)||void 0===n?void 0:n.isNativePlatform)||(()=>"web"!==h()),m=(null===(i=null==u?void 0:u.currentPlatform)||void 0===i?void 0:i.isPluginAvailable)||(e=>{const t=g.get(e);return!!(null==t?void 0:t.platforms.has(h()))||!!f(e)}),f=(null===(r=null==u?void 0:u.currentPlatform)||void 0===r?void 0:r.getPluginHeader)||(e=>{var t;return null===(t=l.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)}),g=new Map,w=(null===(o=null==u?void 0:u.currentPlatform)||void 0===o?void 0:o.registerPlugin)||((e,t={})=>{const n=g.get(e);if(n)return console.warn(`Capacitor plugin "${e}" already registered. Cannot register plugins twice.`),n.proxy;const i=h(),r=f(e);let o;const u=n=>{let d;const u=(...u)=>{const h=(async()=>(!o&&i in t?o=o="function"==typeof t[i]?await t[i]():t[i]:null!==c&&!o&&"web"in t&&(o=o="function"==typeof t.web?await t.web():t.web),o))().then(t=>{const o=((t,n)=>{var o,c;if(!r){if(t)return null===(c=t[n])||void 0===c?void 0:c.bind(t);throw new a(`"${e}" plugin is not implemented on ${i}`,s.Unimplemented)}{const s=null==r?void 0:r.methods.find(e=>n===e.name);if(s)return"promise"===s.rtype?t=>l.nativePromise(e,n.toString(),t):(t,s)=>l.nativeCallback(e,n.toString(),t,s);if(t)return null===(o=t[n])||void 0===o?void 0:o.bind(t)}})(t,n);if(o){const e=o(...u);return d=null==e?void 0:e.remove,e}throw new a(`"${e}.${n}()" is not implemented on ${i}`,s.Unimplemented)});return"addListener"===n&&(h.remove=async()=>d()),h};return u.toString=()=>`${n.toString()}() { [capacitor code] }`,Object.defineProperty(u,"name",{value:n,writable:!1,configurable:!1}),u},p=u("addListener"),m=u("removeListener"),w=(e,t)=>{const s=p({eventName:e},t),a=async()=>{const a=await s;m({eventName:e,callbackId:a},t)},n=new Promise(e=>s.then(()=>e({remove:a})));return n.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await a()},n},y=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return r?w:p;case"removeListener":return m;default:return u(t)}}});return d[e]=y,g.set(e,{name:e,proxy:y,platforms:new Set([...Object.keys(t),...r?[i]:[]])}),y});return l.convertFileSrc||(l.convertFileSrc=e=>e),l.getPlatform=h,l.handleError=t=>e.console.error(t),l.isNativePlatform=p,l.isPluginAvailable=m,l.pluginMethodNoop=(e,t,s)=>Promise.reject(`${s} does not have an implementation of "${t}".`),l.registerPlugin=w,l.Exception=a,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l})(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e.g?e.g:{}),i=n.registerPlugin;n.Plugins;class r{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);const s=this.windowListeners[e];s&&!s.registered&&this.addWindowListener(s);const a=async()=>this.removeListener(e,t),n=Promise.resolve({remove:a});return Object.defineProperty(n,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await a()}}),n}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t){const s=this.listeners[e];s&&s.forEach(e=>e(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new n.Exception(e,s.Unimplemented)}unavailable(e="not available"){return new n.Exception(e,s.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const a=s.indexOf(t);this.listeners[e].splice(a,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}}const o=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),c=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class l extends r{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[s,a]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=c(s).trim(),a=c(a).trim(),t[s]=a}),t}async setCookie(e){try{const t=o(e.key),s=o(e.value),a=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),i=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${a}; path=${n}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}i("CapacitorCookies",{web:()=>new l});class d extends r{async request(e){const t=((e,t={})=>{const s=Object.assign({method:e.method||"GET",headers:e.headers},t),a=((e={})=>{const t=Object.keys(e);return Object.keys(e).map(e=>e.toLocaleLowerCase()).reduce((s,a,n)=>(s[a]=e[t[n]],s),{})})(e.headers)["content-type"]||"";if("string"==typeof e.data)s.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[s,a]of Object.entries(e.data||{}))t.set(s,a);s.body=t.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,s)=>{t.append(s,e)});else for(const s of Object.keys(e.data))t.append(s,e.data[s]);s.body=t;const a=new Headers(s.headers);a.delete("content-type"),s.headers=a}else(a.includes("application/json")||"object"==typeof e.data)&&(s.body=JSON.stringify(e.data));return s})(e,e.webFetchExtra),s=((e,t=!0)=>e?Object.entries(e).reduce((e,s)=>{const[a,n]=s;let i,r;return Array.isArray(n)?(r="",n.forEach(e=>{i=t?encodeURIComponent(e):e,r+=`${a}=${i}&`}),r.slice(0,-1)):(i=t?encodeURIComponent(n):n,r=`${a}=${i}`),`${e}&${r}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),a=s?`${e.url}?${s}`:e.url,n=await fetch(a,t),i=n.headers.get("content-type")||"";let r,o,{responseType:c="text"}=n.ok?e:{};switch(i.includes("application/json")&&(c="json"),c){case"arraybuffer":case"blob":o=await n.blob(),r=await(async e=>new Promise((t,s)=>{const a=new FileReader;a.onload=()=>{const e=a.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},a.onerror=e=>s(e),a.readAsDataURL(e)}))(o);break;case"json":r=await n.json();break;default:r=await n.text()}const l={};return n.headers.forEach((e,t)=>{l[t]=e}),{data:r,headers:l,status:n.status,url:n.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}i("CapacitorHttp",{web:()=>new d});class u{constructor(){this.cache=new Map,this.downloadedAssets=new Map,this.bundledAssets=new Map,this.isInitialized=!1}async initialize(){if(this.isInitialized)return{success:!0,message:"Template manager already initialized"};try{return await this.loadBundledAssets(),await this.loadDownloadedAssets(),this.isInitialized=!0,{success:!0,message:"Template manager initialized successfully"}}catch(e){return{success:!1,error:e.message}}}async loadBundledAssets(){try{const e={"quotation/cra":await this.loadAsset("assets/templates/cra/sqs_template.html"),"quotation/life-saver":await this.loadAsset("assets/templates/life-saver/sqs_template.html"),"quotation/life":await this.loadAsset("assets/templates/life/sqs_template.html"),"quotation/pradeepa":await this.loadAsset("assets/templates/pradeepa/sqs_template.html"),"quotation/investment":await this.loadAsset("assets/templates/investment/sqs_template.html"),"quotation/advance-payment":await this.loadAsset("assets/templates/advance-payment/sqs_template.html")};for(const[t,s]of Object.entries(e))s&&this.bundledAssets.set(t,s);console.log("Bundled assets loaded successfully")}catch(e){console.warn("Failed to load bundled assets:",e.message)}}async loadDownloadedAssets(){try{const e=localStorage.getItem("downloadedTemplates");if(e){const t=JSON.parse(e);for(const[e,s]of Object.entries(t))this.downloadedAssets.set(e,s);console.log("Downloaded assets loaded successfully")}}catch(e){console.warn("Failed to load downloaded assets:",e.message)}}async loadAsset(e){try{const t=await fetch(e);return t.ok?await t.text():null}catch(t){return console.warn(`Failed to load asset: ${e}`,t.message),null}}async selectTemplateAndConfig(e){const{productName:t,productType:s,planName:a,outputType:n}=e,i=a?.replace(/\s+/g,"-").toLowerCase()||"",r=s?.replace(/\s+/g,"-").toLowerCase()||"";let o=await this.getTemplateFromDownloaded(n,i,r),c=await this.getConfigFromDownloaded(n,i,r);return o||(o=await this.getTemplateFromBundled(n,i,r),c=await this.getConfigFromBundled(n,i,r)),o||(o=this.getDefaultTemplate(n),c=this.getDefaultConfig(n)),{templateHtml:o,tableFormatJson:c,normalizedProductName:r,normalizedPlanName:i}}getTemplateKey(e){const t=e?.replace(/\s+/g,"-").toLowerCase()||"";return this.bundledAssets.has(`quotation/${t}`)?`quotation/${t}`:t.includes("saver")?"quotation/life-saver":"quotation/cra"}async getTemplateFromDownloaded(e,t,s){const a=[`${e}/${t}`,`${e}/${s}`,`${e}/default`];for(const e of a){const t=this.downloadedAssets.get(e);if(t)return t}return null}async getTemplateFromBundled(e,t,s){const a=[`${e}/${t}`,`${e}/${s}`,`${e}/default`];for(const e of a){const t=this.bundledAssets.get(e);if(t)return t}return null}async getConfigFromDownloaded(e,t,s){return this.getDefaultConfig(e)}async getConfigFromBundled(e,t,s){return this.getDefaultConfig(e)}getDefaultTemplate(e){const t={quotation:'\n        <div class="header">\n          <h1>Quotation</h1>\n          <p>Product: ||productName||</p>\n          <p>Quote ID: ||QuoteId||</p>\n        </div>\n        <div class="section">\n          <h2>Primary Insured</h2>\n          <p>Name: ||primaryInsured.person.name.first|| ||primaryInsured.person.name.last||</p>\n          <p>Age: ||primaryInsured.person.age||</p>\n        </div>\n      ',proposal:'\n        <div class="header">\n          <h1>Proposal</h1>\n          <p>Product: ||product.planName||</p>\n        </div>\n        <div class="section">\n          <h2>Application Details</h2>\n          <p>Application Type: ||applicationType||</p>\n        </div>\n      ',fna:'\n        <div class="header">\n          <h1>Financial Needs Analysis</h1>\n          <p>FNA ID: ||fnaMainId||</p>\n        </div>\n        <div class="section">\n          <h2>Analysis Results</h2>\n        </div>\n      '};return t[e]||t.quotation}getDefaultConfig(e){const t={quotation:{TableCreateJSON:["primaryInsured.coverages","spouseInsured.coverages"],protectionBenefitsRider:[],healthBenefitsRider:[],disabilityBenefitsRider:[],RiderTablecreate:[],lossoflife:[],lossofaccident:[],riderData:[],DivShowHide:[],excludeHeaders:[],summarybenefit:[],summarytable:[],summarybenefitekey:[]},proposal:{TableCreateJSON:[],DivShowHide:[],excludeHeaders:[]},fna:{TableCreateJSON:[],DivShowHide:[],excludeHeaders:[]}};return t[e]||t.quotation}async storeDownloadedTemplates(e){try{for(const[t,s]of Object.entries(e))this.downloadedAssets.set(t,s);const t={};for(const[e,s]of this.downloadedAssets.entries())t[e]=s;return localStorage.setItem("downloadedTemplates",JSON.stringify(t)),{success:!0,message:"Templates stored successfully"}}catch(e){return{success:!1,error:e.message}}}async getVersion(){return{bundled:"1.0.0",downloaded:this.downloadedAssets.size>0?"1.0.0":null,totalTemplates:this.bundledAssets.size+this.downloadedAssets.size}}clearCache(){return this.cache.clear(),{success:!0,message:"Template cache cleared"}}getCacheStats(){return{bundledAssets:this.bundledAssets.size,downloadedAssets:this.downloadedAssets.size,cacheSize:this.cache.size}}}const h=new u;class p{constructor(){this.csvData=null,this.isInitialized=!1}async initialize(){if(this.isInitialized)return{success:!0,message:"CSV loader already initialized"};try{return await this.loadPlanWiseRiderCSV(),this.isInitialized=!0,{success:!0,message:"CSV loader initialized successfully"}}catch(e){return{success:!1,error:e.message}}}async loadPlanWiseRiderCSV(){try{const e=await fetch("assets/csv/PlanWiseRider.csv");if(!e.ok)throw new Error(`Failed to load CSV: ${e.status}`);const t=await e.text();return this.csvData=this.parseCSV(t),console.log("PlanWiseRider.csv loaded successfully"),this.csvData}catch(e){return console.warn("Failed to load PlanWiseRider.csv:",e.message),this.csvData=[],this.csvData}}parseCSV(e){const t=e.split("\n");if(t.length<2)return[];const s=t[0].split(",").map(e=>e.trim().replace(/"/g,"")),a=[];for(let e=1;e<t.length;e++){const n=t[e].trim();if(!n)continue;const i=this.parseCSVLine(n);if(i.length===s.length){const e={};s.forEach((t,s)=>{e[t]=i[s]||""}),a.push(e)}}return a}parseCSVLine(e){const t=[];let s="",a=!1;for(let n=0;n<e.length;n++){const i=e[n];'"'===i?a=!a:","!==i||a?s+=i:(t.push(s.trim()),s="")}return t.push(s.trim()),t}async filterPlanWiseRiderCSV(e,t,s){if(!this.csvData||0===this.csvData.length)return console.warn("No CSV data available for filtering"),[];console.log("Filtering PlanWiseRider.csv with:",{planCode:e,lifeName:t,paymentFrequency:s});const a={A:"A",S:"S",Q:"Q",M:"M",R:"R"}[s]||s,n=this.csvData.filter(s=>{const n=s.planCode===e.toString(),i=s.lifeName===t,r=s.paymentFrequency===a;return n&&i&&r});return console.log("Filtered products:",n.length),n}async loadPlanWiseRiderCSV(e,t,s){return this.isInitialized||await this.initialize(),await this.filterPlanWiseRiderCSV(e,t,s)}getAllCSVData(){return this.csvData||[]}getUniqueValues(e){if(!this.csvData)return[];const t=new Set;return this.csvData.forEach(s=>{s[e]&&t.add(s[e])}),Array.from(t)}getCSVStats(){return this.csvData?{totalRows:this.csvData.length,columns:this.csvData.length>0?Object.keys(this.csvData[0]):[],isLoaded:!0}:{totalRows:0,columns:[],isLoaded:!1}}clearCSVData(){return this.csvData=null,this.isInitialized=!1,{success:!0,message:"CSV data cleared"}}}class m{constructor(){this.cache=new Map,this.isInitialized=!1}async initialize(){if(this.isInitialized)return{success:!0,message:"PDF generator already initialized"};try{return void 0===window.html2pdf&&await this.loadHtml2Pdf(),this.isInitialized=!0,{success:!0,message:"PDF generator initialized successfully"}}catch(e){return{success:!1,error:e.message}}}async loadHtml2Pdf(){return new Promise((e,t)=>{if(void 0!==window.html2pdf)return void e();const s=document.createElement("script");s.src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js",s.onload=()=>{console.log("html2pdf.js loaded successfully"),e()},s.onerror=()=>{t(new Error("Failed to load html2pdf.js"))},document.head.appendChild(s)})}async generatePDF(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=Date.now(),a=this.generateCacheKey(e,t);if(this.cache.has(a))return this.cache.get(a);try{this.isInitialized||await this.initialize();const n=document.createElement("div");n.innerHTML=e,n.style.position="absolute",n.style.left="-9999px",n.style.top="-9999px",document.body.appendChild(n);const i={margin:[10,10,10,10],filename:"generated-document.pdf",image:{type:"jpeg",quality:.98},html2canvas:{scale:2,useCORS:!0,allowTaint:!0},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"},...t},r=await this.htmlToPdfBlob(n,i);document.body.removeChild(n);const o={success:!0,data:r,metadata:{processingTime:Date.now()-s,size:r.size,type:r.type}};return this.cache.set(a,o),o}catch(e){const t={success:!1,error:`PDF generation failed: ${e.message}`,metadata:{processingTime:Date.now()-s,size:0}};return this.cache.set(a,t),t}}async htmlToPdfBlob(e,t){return new Promise((s,a)=>{try{window.html2pdf().from(e).set(t).outputPdf("blob").then(e=>{s(e)}).catch(e=>{a(e)})}catch(e){a(e)}})}generateCacheKey(e,t){return`${this.simpleHash(e)}-${this.simpleHash(JSON.stringify(t))}`}simpleHash(e){let t=0;if(0===e.length)return t;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t&=t;return t.toString()}clearCache(){return this.cache.clear(),{success:!0,message:"PDF generator cache cleared"}}getCacheStats(){return{cacheSize:this.cache.size,cacheKeys:Array.from(this.cache.keys())}}}class f{constructor(){this.templateManager=h,this.csvLoader=new p,this.pdfGenerator=new m,this.cache=new Map,this.isInitialized=!1}async initialize(){if(this.isInitialized)return{success:!0,message:"Quotation processor already initialized"};try{return await this.csvLoader.initialize(),await this.pdfGenerator.initialize(),this.isInitialized=!0,{success:!0,message:"Quotation processor initialized successfully"}}catch(e){return{success:!1,error:e.message}}}async process(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=Date.now(),n=this.generateCacheKey(e,t,s);if(this.cache.has(n))return this.cache.get(n);try{const t=e.productName?.replace(/\s+/g,"-").toLowerCase()||"",a=await this.processIllustrationInput(e,t),i=document.createElement("div");i.innerHTML=a.templateHtml,await this.fnKeyValueRecursiveCall(i,e,a);const r=this.fnfindShowHidePositions(i,e,a);this.fnfindArrayDifference(i,r,a),await this.fnnoteaccordingtoplantype(i,t,a.normalizedProductName);const o=i.innerHTML,c=await this.pdfGenerator.generatePDF(o,s||{format:"pdf"});return this.cache.set(n,c),c}catch(e){const s={success:!1,error:`Quotation processing failed: ${e}`,metadata:{processingTime:Date.now()-a,templateUsed:t||"unknown",outputSize:0}};return this.cache.set(n,s),s}}async processIllustrationInput(e,t){const s=t.replace(/\s+/g,"-").toLowerCase(),a=(e.productType||"").replace(/\s+/g,"-").toLowerCase();let n="",i="";this.templateManager.bundledAssets.has(`quotation/${s}`)?(n=`quotation/${s}`,i=s):s.includes("saver")?(n="quotation/life-saver",i="life-saver"):(n="quotation/cra",i="cra");const r=this.templateManager.bundledAssets.get(n);if(!r)throw new Error(`Template not found: ${n}`);const o=await fetch(`assets/templates/${i}/TableFormat.json`);if(!o.ok)throw new Error(`Config not found: ${i}/TableFormat.json`);const c=await o.json();return{templateHtml:r,tableFormatJson:c,normalizedProductName:a,normalizedPlanName:s,TableCreateJSON:c.TableCreateJSON||[],protectionBenefitsRider:c.protectionBenefitsRider||[],healthBenefitsRider:c.healthBenefitsRider||[],disabilityBenefitsRider:c.disabilityBenefitsRider||[],RiderTablecreate:c.RiderTablecreate||[],lossoflife:c.lossoflife||[],lossofaccident:c.lossofaccident||[],riderData:c.rider_data||[],DivShowHide:c.DivShowHide||[],excludeHeaders:c.excludeHeaders||[],summarybenefit:c.summarybenefit||[],summarytable:c.summarytable||[],summarybenefitekey:c.summarybenefitekey||[]}}async fnKeyValueRecursiveCall(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if("object"==typeof t&&null!==t){for(const e in t)if(t.hasOwnProperty(e)){const n=a?`${a}.${e}`:e;if(s.TableCreateJSON.includes(n)){const a=n.split(".")[0],i=(n.split(".")[1],await this.csvLoader.loadPlanWiseRiderCSV(t.productCode,a,t.paymentFrequency));await this.fngenerateTable(t[e],s,n,i)}else await this.fnKeyValueRecursiveCall(t[e],t,s,n)}}else{const s=`||${a}||`,n=null!=t?t:"";e.querySelectorAll("*").forEach(e=>{e.innerHTML.includes(s)&&(e.innerHTML=e.innerHTML.replace(new RegExp(s,"g"),n))})}}fnfindShowHidePositions(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if("object"==typeof t&&null!==t)for(const e in t)if(t.hasOwnProperty(e)){const i=a?`${a}.${e}`:e;s.DivShowHide.includes(i)&&n.push(i),this.fnfindShowHidePositions(t[e],t,s,i,n)}return n}fnfindArrayDifference(e,t,s){s.DivShowHide.filter(e=>!t.includes(e)).forEach(t=>{e.querySelectorAll(`[data-key="${t}"]`).forEach(e=>{e.style.display="none"})})}async fngenerateTable(e,t,s,a){if(!e||!Array.isArray(e))return;s.split(".")[0],s.split(".")[1];let n='<table class="data-table">';a.length>0&&(n+="<thead><tr>",Object.keys(a[0]).forEach(e=>{t.excludeHeaders.includes(e)||(n+=`<th>${this.getHeaderReplacement(t,e)}</th>`)}),n+="</tr></thead>"),n+="<tbody>",e.forEach(e=>{n+="<tr>",Object.keys(e).forEach(s=>{t.excludeHeaders.includes(s)||(n+=`<td>${e[s]||""}</td>`)}),n+="</tr>"}),n+="</tbody></table>";const i=`||${s}||`;dom.querySelectorAll("*").forEach(e=>{e.innerHTML.includes(i)&&(e.innerHTML=e.innerHTML.replace(new RegExp(i,"g"),n))})}getHeaderReplacement(e,t){return t}async fnnoteaccordingtoplantype(e,t,s){try{const a=await fetch("assets/notes/notes_files.json");if(a.ok){const n=await a.json(),i=n[t]||n[s]||[];if(i.length>0){let t='<div class="notes-section"><h3>Notes</h3><ul>';i.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul></div>";const s=e.querySelector(".notes-container");s&&(s.innerHTML=t)}}}catch(e){console.warn("Failed to load notes:",e.message)}}generateCacheKey(e,t,s){return`${JSON.stringify(e)}-${t||""}-${JSON.stringify(s)}`}clearCache(){return this.cache.clear(),{success:!0,message:"Quotation processor cache cleared"}}getCacheStats(){return{cacheSize:this.cache.size,cacheKeys:Array.from(this.cache.keys())}}}class g{constructor(){this.templateManager=h,this.pdfGenerator=new m,this.cache=new Map,this.isInitialized=!1}async initialize(){if(this.isInitialized)return{success:!0,message:"Proposal processor already initialized"};try{return await this.pdfGenerator.initialize(),this.isInitialized=!0,{success:!0,message:"Proposal processor initialized successfully"}}catch(e){return{success:!1,error:e.message}}}async process(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=Date.now(),n=this.generateCacheKey(e,t,s);if(this.cache.has(n))return this.cache.get(n);try{const t=e.product?.planName?.replace(/\s+/g,"-").toLowerCase()||"",a=await this.processProposalInput(e,t),i=document.createElement("div");i.innerHTML=a.templateHtml,await this.fnKeyValueRecursiveCall(i,e,a);const r=this.fnfindShowHidePositions(i,e,a);this.fnfindArrayDifference(i,r,a);const o=i.innerHTML,c=await this.pdfGenerator.generatePDF(o,s||{format:"pdf"});return this.cache.set(n,c),c}catch(e){const s={success:!1,error:`Proposal processing failed: ${e}`,metadata:{processingTime:Date.now()-a,templateUsed:t||"unknown",outputSize:0}};return this.cache.set(n,s),s}}async processProposalInput(e,t){const s=t.replace(/\s+/g,"-").toLowerCase(),a=(e.product?.productType||"").replace(/\s+/g,"-").toLowerCase(),n=await this.templateManager.selectTemplateAndConfig({productName:e.product?.planName||"",productType:e.product?.productType||"",planName:s,outputType:"proposal"});return{templateHtml:n.templateHtml,tableFormatJson:n.tableFormatJson,normalizedProductName:a,normalizedPlanName:s}}async fnKeyValueRecursiveCall(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if("object"==typeof t&&null!==t){for(const e in t)if(t.hasOwnProperty(e)){const n=a?`${a}.${e}`:e;await this.fnKeyValueRecursiveCall(t[e],t,s,n)}}else{const s=`||${a}||`,n=null!=t?t:"";e.querySelectorAll("*").forEach(e=>{e.innerHTML.includes(s)&&(e.innerHTML=e.innerHTML.replace(new RegExp(s,"g"),n))})}}fnfindShowHidePositions(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if("object"==typeof t&&null!==t)for(const e in t)if(t.hasOwnProperty(e)){const i=a?`${a}.${e}`:e;s.DivShowHide&&s.DivShowHide.includes(i)&&n.push(i),this.fnfindShowHidePositions(t[e],t,s,i,n)}return n}fnfindArrayDifference(e,t,s){s.DivShowHide&&s.DivShowHide.filter(e=>!t.includes(e)).forEach(t=>{e.querySelectorAll(`[data-key="${t}"]`).forEach(e=>{e.style.display="none"})})}generateCacheKey(e,t,s){return`${JSON.stringify(e)}-${t||""}-${JSON.stringify(s)}`}clearCache(){return this.cache.clear(),{success:!0,message:"Proposal processor cache cleared"}}getCacheStats(){return{cacheSize:this.cache.size,cacheKeys:Array.from(this.cache.keys())}}}class w{constructor(){this.templateManager=h,this.pdfGenerator=new m,this.cache=new Map,this.isInitialized=!1}async initialize(){if(this.isInitialized)return{success:!0,message:"FNA processor already initialized"};try{return await this.pdfGenerator.initialize(),this.isInitialized=!0,{success:!0,message:"FNA processor initialized successfully"}}catch(e){return{success:!1,error:e.message}}}async process(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=Date.now(),n=this.generateCacheKey(e,t,s);if(this.cache.has(n))return this.cache.get(n);try{const t=await this.processFNAInput(e),a=document.createElement("div");a.innerHTML=t.templateHtml,await this.fnKeyValueRecursiveCall(a,e,t);const i=a.innerHTML,r=await this.pdfGenerator.generatePDF(i,s||{format:"pdf"});return this.cache.set(n,r),r}catch(e){const s={success:!1,error:`FNA processing failed: ${e}`,metadata:{processingTime:Date.now()-a,templateUsed:t||"unknown",outputSize:0}};return this.cache.set(n,s),s}}async processFNAInput(e){const t=await this.templateManager.selectTemplateAndConfig({productName:"",productType:"",planName:"",outputType:"fna"});return{templateHtml:t.templateHtml,tableFormatJson:t.tableFormatJson}}async fnKeyValueRecursiveCall(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if("object"==typeof t&&null!==t){for(const e in t)if(t.hasOwnProperty(e)){const n=a?`${a}.${e}`:e;await this.fnKeyValueRecursiveCall(t[e],t,s,n)}}else{const s=`||${a}||`,n=null!=t?t:"";e.querySelectorAll("*").forEach(e=>{e.innerHTML.includes(s)&&(e.innerHTML=e.innerHTML.replace(new RegExp(s,"g"),n))})}}generateCacheKey(e,t,s){return`${JSON.stringify(e)}-${t||""}-${JSON.stringify(s)}`}clearCache(){return this.cache.clear(),{success:!0,message:"FNA processor cache cleared"}}getCacheStats(){return{cacheSize:this.cache.size,cacheKeys:Array.from(this.cache.keys())}}}class y{constructor(){this.isInitialized=!1,this.syncInProgress=!1}async initialize(){if(this.isInitialized)return{success:!0,message:"Asset sync service already initialized"};try{return this.isInitialized=!0,{success:!0,message:"Asset sync service initialized successfully"}}catch(e){return{success:!1,error:e.message}}}async syncTemplates(e){if(this.syncInProgress)return{success:!1,error:"Sync already in progress"};this.syncInProgress=!0;try{const t=await this.downloadManifest(e);if(!await this.compareVersions(t))return this.syncInProgress=!1,{success:!0,message:"Templates are up to date"};const s=await this.downloadTemplates(t);return await this.storeTemplates(s),await this.updateLocalManifest(t),this.syncInProgress=!1,{success:!0,message:"Templates updated successfully"}}catch(e){return this.syncInProgress=!1,{success:!1,error:e.message}}}async downloadManifest(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`Failed to download manifest: ${t.status}`);return await t.json()}catch(e){throw new Error(`Failed to download manifest: ${e.message}`)}}async compareVersions(e){try{const t=this.getLocalManifest(),s=e.version||"1.0.0",a=t.version||"0.0.0";return this.isVersionNewer(s,a)}catch(e){return!0}}isVersionNewer(e,t){const s=e.split(".").map(Number),a=t.split(".").map(Number);for(let e=0;e<Math.max(s.length,a.length);e++){const t=s[e]||0,n=a[e]||0;if(t>n)return!0;if(t<n)return!1}return!1}async downloadTemplates(e){const t={};try{for(const[s,a]of Object.entries(e.templates)){const e=a.url,n=await fetch(e);if(n.ok){const e=await n.text();t[s]={content:e,version:a.version,lastModified:a.lastModified}}else console.warn(`Failed to download template: ${s}`)}return t}catch(e){throw new Error(`Failed to download templates: ${e.message}`)}}async storeTemplates(e){try{const t={};for(const[s,a]of Object.entries(e))t[s]=a;return localStorage.setItem("downloadedTemplates",JSON.stringify(t)),{success:!0,message:"Templates stored successfully"}}catch(e){throw new Error(`Failed to store templates: ${e.message}`)}}async updateLocalManifest(e){try{return localStorage.setItem("templateManifest",JSON.stringify(e)),{success:!0,message:"Local manifest updated"}}catch(e){throw new Error(`Failed to update local manifest: ${e.message}`)}}getLocalManifest(){try{const e=localStorage.getItem("templateManifest");return e?JSON.parse(e):null}catch(e){return console.warn("Failed to get local manifest:",e.message),null}}getDownloadedTemplates(){try{const e=localStorage.getItem("downloadedTemplates");return e?JSON.parse(e):{}}catch(e){return console.warn("Failed to get downloaded templates:",e.message),{}}}async clearDownloadedTemplates(){try{return localStorage.removeItem("downloadedTemplates"),localStorage.removeItem("templateManifest"),{success:!0,message:"Downloaded templates cleared"}}catch(e){return{success:!1,error:e.message}}}getSyncStatus(){return{isInitialized:this.isInitialized,syncInProgress:this.syncInProgress,localManifest:this.getLocalManifest(),downloadedTemplates:Object.keys(this.getDownloadedTemplates()).length}}async forceSync(e){try{const t=await this.downloadManifest(e),s=await this.downloadTemplates(t);return await this.storeTemplates(s),await this.updateLocalManifest(t),{success:!0,message:"Force sync completed successfully"}}catch(e){return{success:!1,error:e.message}}}}const v=new class{constructor(){this.quotationProcessor=new f,this.proposalProcessor=new g,this.fnaProcessor=new w,this.templateManager=new u,this.assetSyncService=new y,this.isInitialized=!1,this.isMobile=n.isNativePlatform()}async initialize(){if(this.isInitialized)return{success:!0,message:"Plugin already initialized"};try{return await this.templateManager.initialize(),await this.quotationProcessor.initialize(),await this.proposalProcessor.initialize(),await this.fnaProcessor.initialize(),this.isInitialized=!0,{success:!0,message:"Plugin initialized successfully",platform:this.isMobile?"mobile":"web"}}catch(e){return{success:!1,error:e.message}}}async generatePDF(e){const{outputType:t,inputData:s,template:a}=e;if(!this.isMobile)throw new Error("PDF generation on web requires internet connection. Please use the backend API directly.");return await this.checkConnectivity()?await this.callBackendAPI(t,s):await this.callPluginAPI(t,s,a)}async checkConnectivity(){try{return await fetch("https://httpbin.org/get",{method:"HEAD",mode:"no-cors"}),!0}catch(e){return!1}}async callBackendAPI(e,t){const s={quotation:"http://192.168.2.7:4004/outputProcessingService/quotation",proposal:"http://192.168.2.7:4004/outputProcessingService/proposal",fna:"http://192.168.2.7:4004/outputProcessingService/fna"}[e];if(!s)throw new Error(`Unknown output type: ${e}`);try{const e=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`Backend API error: ${e.status}`);const a=(await e.json())[0].base64content.replace(/^data:application\/pdf;base64,/,""),n=atob(a),i=n.length,r=new Uint8Array(i);for(let e=0;e<i;e++)r[e]=n.charCodeAt(e);const o=new Blob([r],{type:"application/pdf"});return{success:!0,data:URL.createObjectURL(o),source:"backend-api"}}catch(e){throw new Error(`Backend API failed: ${e.message}`)}}async callPluginAPI(e,t,s){this.isInitialized||await this.initialize();try{let a;switch(e){case"quotation":a=await this.quotationProcessor.process(t,s);break;case"proposal":a=await this.proposalProcessor.process(t,s);break;case"fna":a=await this.fnaProcessor.process(t,s);break;default:throw new Error(`Unknown output type: ${e}`)}return{success:!0,data:a.data,source:"plugin-offline"}}catch(e){throw new Error(`Plugin processing failed: ${e.message}`)}}async updateTemplates(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.isMobile)throw new Error("Template updates are only available on mobile devices");try{return await this.assetSyncService.syncTemplates(e.url),{success:!0,message:"Templates updated successfully"}}catch(e){return{success:!1,error:e.message}}}async getTemplateVersion(){return await this.templateManager.getVersion()}async clearCache(){return this.quotationProcessor.clearCache(),this.proposalProcessor.clearCache(),this.fnaProcessor.clearCache(),this.templateManager.clearCache(),{success:!0,message:"All caches cleared"}}async getPluginInfo(){return{name:"Capacitor PDF Generator",version:"1.0.0",description:"Hybrid PDF generation plugin for mobile devices",platform:this.isMobile?"mobile":"web",features:["quotation","proposal","fna"],initialized:this.isInitialized,strategy:"hybrid-web-mobile"}}async isReady(){return this.isInitialized}};export{w as FNAProcessor,g as ProposalProcessor,f as QuotationProcessor,v as default};